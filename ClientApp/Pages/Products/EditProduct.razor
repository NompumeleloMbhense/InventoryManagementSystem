@page "/products/edit/{id:int}"
@using ClientApp.Models
@using ClientApp.Services
@inject ProductService ProductService
@inject NavigationManager Navigation

<h3>Edit Product</h3>

@if (productForm is null)
{
    <p><em>Loading...</em></p>
}
else
{
    <ProductForm FormModel="@productForm" SubmitButtonText="Update Product" OnValidSubmitForm="HandleUpdate" />
}

@code
{
    [Parameter]
    public int id { get; set; }
    private ProductFormModel? productForm;

    protected override async Task OnInitializedAsync()
    {
        var product = await ProductService.GetByIdAsync(id);

        if (product is not null)
        {
            productForm = new ProductFormModel
            {

                Name = product.Name,
                Price = product.Price,
                Stock = product.Stock,
                Category = product.Category,
                SupplierId = product.SupplierId
            };
        }
    }

    private async Task HandleUpdate(ProductFormModel model)
    {
        var dto = new ProductUpdateDto
        {
            Name = model.Name,
            Price = model.Price,
            Stock = model.Stock,
            Category = model.Category,
            SupplierId = model.SupplierId
        };

        var success = await ProductService.UpdateAsync(id, dto);
        if (success)
            Navigation.NavigateTo("/products");
    
    }
}