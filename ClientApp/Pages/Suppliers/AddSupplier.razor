@page "/suppliers/add"
@using ClientApp.Models
@using ClientApp.Services
@inject SupplierService SupplierService
@inject NavigationManager Navigation

<h3 class="text-2xl font-semibold mb-3">Add Supplier</h3>

<SupplierForm FormModel="@supplierForm" SubmitButtonText="Add Supplier" OnValidSubmitForm="HandleAdd" />

@code
{
    private SupplierFormModel supplierForm = new();
    private bool isSubmitting = false;

    // It is an async method because in a real application,
    // you need to not block the UI thread while waiting for the server response
    //
    private async Task HandleAdd(SupplierFormModel model)
    {
        
        // Assign the form model data to the DTO
        // and call the service to add the supplier
        var dto = new SupplierCreateDto
        {
            Name = model.Name,
            Location = model.Location,
            Email = model.Email
        };

        var success = await SupplierService.CreateAsync(dto);


        if (success)
            Navigation.NavigateTo("/suppliers");
        else
            // Handle failure (e.g show an error message)
            Console.WriteLine("Failed to add a supplier");
    }
}